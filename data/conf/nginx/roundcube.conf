upstream php-handler-roundcube {
  server roundcube:9000;
}

server {
  listen   80;
  server_name roundcube.webmail.*;
  root     /roundcube;
  index    index.php;

  add_header Strict-Transport-Security "max-age=15768000; includeSubDomains";
  add_header X-Content-Type-Options nosniff;
  add_header X-XSS-Protection "1; mode=block";
  add_header X-Robots-Tag none;
  add_header X-Download-Options noopen;
  add_header X-Permitted-Cross-Domain-Policies none;

  location = /favicon.ico {
      root /roundcube/skins/elastic/images;
      access_log     off;
      log_not_found  off;
      expires        max;
  }

  location = /robots.txt {
      allow          all;
      access_log     off;
      log_not_found  off;
  }

  location / {
      try_files $uri $uri/ index.php;
  }

  location ~ /\.ht {
      deny           all;
      access_log     off;
      log_not_found  off;
  }

  location ~* \.php$ {
      try_files      $uri =404;
      include        fastcgi_params;
      fastcgi_split_path_info ^(.+\.php)(/.+)$;
      fastcgi_pass   php-handler-roundcube;
      fastcgi_param  SCRIPT_FILENAME  /app$fastcgi_script_name;
      fastcgi_index  index.php;
  }
}
